/*
 *               ~ CLNDR v1.2.0 ~
 * ==============================================
 *       https://github.com/kylestetz/CLNDR
 * ==============================================
 *  created by kyle stetz (github.com/kylestetz)
 *        &available under the MIT license
 * http://opensource.org/licenses/mit-license.php
 * ==============================================
 *
 * This is the fully-commented development version of CLNDR.
 * For the production version, check out clndr.min.js
 * at https://github.com/kylestetz/CLNDR
 *
 * This work is based on the
 * jQuery lightweight plugin boilerplate
 * Original author: @ajpiano
 * Further changes, comments: @addyosmani
 * Licensed under the MIT license
 *//*global moment*/(function(e,t,n,r){"use strict";function u(t,n){this.element=t,this.options=e.extend(!0,{},o,n),this._defaults=o,this._name=s,this.init()}var i="<div class='clndr-controls'><div class='clndr-control-button'><span class='clndr-previous-button'>previous</span></div><div class='month'><%= month %> <%= year %></div><div class='clndr-control-button rightalign'><span class='clndr-next-button'>next</span></div></div><table class='clndr-table' border='0' cellspacing='0' cellpadding='0'><thead><tr class='header-days'><% for(var i = 0; i < daysOfTheWeek.length; i++) { %><td class='header-day'><%= daysOfTheWeek[i] %></td><% } %></tr></thead><tbody><% for(var i = 0; i < numberOfRows; i++){ %><tr><% for(var j = 0; j < 7; j++){ %><% var d = j + i * 7; %><td class='<%= days[d].classes %>'><div class='day-contents'><%= days[d].day %></div></td><% } %></tr><% } %></tbody></table>",s="clndr",o={template:i,startWithMonth:null,clickEvents:{click:null,nextMonth:null,previousMonth:null,nextYear:null,previousYear:null,today:null,onMonthChange:null,onYearChange:null,onIntervalChange:null},targets:{nextButton:"clndr-next-button",previousButton:"clndr-previous-button",nextYearButton:"clndr-next-year-button",previousYearButton:"clndr-previous-year-button",todayButton:"clndr-today-button",scrollable:"clndr-scrollable",day:"day",empty:"empty"},extras:null,extraDateData:null,dateParameter:"date",doneRendering:null,render:null,daysOfTheWeek:null,ready:null,constraints:null,grid:null,lengthOfTime:{interval:1,intervalUnit:"months",increment:1}};u.prototype.init=function(){this.daysOfTheWeek=this.options.daysOfTheWeek||[];if(!this.options.daysOfTheWeek){this.daysOfTheWeek=[];for(var t=0;t<7;t++)this.daysOfTheWeek.push(moment().weekday(t).format("dd").charAt(0))}this.options.weekOffset&&(this.daysOfTheWeek=this.shiftWeekdayLabels(this.options.weekOffset));if(!e.isFunction(this.options.render)){this.options.render=null;if(typeof _=="undefined")throw new Error("Underscore was not found. Please include underscore.js OR provide a custom render function.");this.compiledClndrTemplate=_.template(this.options.template)}e(this.element).html("<div class='clndr'></div>"),this.calendarContainer=e(".clndr",this.element),this.bindEvents(),this.applyChange(this.options.lengthOfTime.startDate),this.selectedDate=this.intervalStart.clone(),this.options.ready&&this.options.ready.apply(this,[])},u.prototype.shiftWeekdayLabels=function(e){var t=this.daysOfTheWeek;for(var n=0;n<e;n++)t.push(t.shift());return t},u.prototype.createDaysObject=function(e,t){var n=[],r=e.clone(),i=t.diff(e,"days");this._currentIntervalStart=e.clone();if(this.options.grid){var s=r.weekday()-this.options.weekOffset;s<0&&(s+=7);if(this.options.grid&&this.options.grid.showAdjacentMonths)for(var o=0;o<s;o++){var u=moment([e.year(),e.month(),o-s+1]);n.push(this.createDayObject(u,this.eventsLastMonth))}else for(var a=0;a<s;a++)n.push(this.calendarDay({classes:this.options.targets.empty+" last-month"}))}var f=e.clone();while(f.isBefore(t)||f.isSame(t,"day"))n.push(this.createDayObject(f.clone(),this.eventsThisInterval)),f.add("days",1);if(this.options.grid)while(n.length%7!==0)this.options.showAdjacentMonths?n.push(this.createDayObject(f.clone(),this.eventsNextMonth)):n.push(this.calendarDay({classes:this.options.targets.empty+" next-month"})),f.add("days",1);if(this.options.grid&&this.options.grid.forceSixRows&&n.length!==42)while(n.length<42)this.options.showAdjacentMonths?(n.push(this.createDayObject(f.clone(),this.eventsNextMonth)),f.add("days",1)):n.push(this.calendarDay({classes:this.options.targets.empty+" next-month"}));return n},u.prototype.createDayObject=function(t,n,i){var s=[],o=moment(),u=this;!t.isValid()&&t.hasOwnProperty("_d")&&t._d!==r&&(t=moment(t._d));var a="";o.format("YYYY-MM-DD")==t.format("YYYY-MM-DD")&&(a+=" today"),t.isBefore(o,"day")&&(a+=" past"),this.options.grid&&(this._currentIntervalStart.month()>t.month()?(a+=" adjacent-month",a+=this._currentIntervalStart.year()===t.year()?" last-month":" next-month"):this._currentIntervalStart.month()<t.month()&&(a+=" adjacent-month",a+=this._currentIntervalStart.year()===t.year()?" next-month":" last-month")),this.options.constraints&&(this.options.constraints.startDate&&t.isBefore(moment(this.options.constraints.startDate))&&(a+=" inactive"),this.options.constraints.endDate&&t.isAfter(moment(this.options.constraints.endDate))&&(a+=" inactive")),t.isSame(this.selectedDate,"day")&&(a+=" selected"),a+=" calendar-day-"+t.format("YYYY-MM-DD"),a+=" calendar-dow-"+t.weekday();var f={day:"",classes:this.options.targets.empty,events:[],date:null},l=e.extend({},f,{day:t,intervalStart:i,classes:this.options.targets.day+a});return this.options.extraDateData?e.extend({},l,this.options.extraDateData(t)):l},u.prototype.render=function(){this.calendarContainer.children().remove();var e=this.createDaysObject(this.intervalStart.clone(),this.intervalEnd.clone()),t={daysOfTheWeek:this.daysOfTheWeek,days:e,intervalStart:this.intervalStart.clone(),intervalEnd:this.intervalEnd.clone(),extras:this.options.extras};this.options.render?this.calendarContainer.html(this.options.render.apply(this,[t])):this.calendarContainer.html(this.compiledClndrTemplate(t));if(this.options.constraints){for(var n in this.options.targets)n!=this.options.targets.day&&this.element.find("."+this.options.targets[n]).toggleClass("inactive",!1);var r=null,i=null;this.options.constraints.startDate&&(r=moment(this.options.constraints.startDate)),this.options.constraints.endDate&&(i=moment(this.options.constraints.endDate)),r&&(r.isAfter(this.intervalStart)||r.isSame(this.intervalStart,"day"))&&this.element.find("."+this.options.targets.previousButton).toggleClass("inactive",!0),i&&(i.isBefore(this.intervalEnd)||i.isSame(this.intervalEnd,"day"))&&this.element.find("."+this.options.targets.nextButton).toggleClass("inactive",!0),r&&r.isAfter(this.intervalStart.clone().subtract("years",1))&&this.element.find("."+this.options.targets.previousYearButton).toggleClass("inactive",!0),i&&i.isBefore(this.intervalEnd.clone().add("years",1))&&this.element.find("."+this.options.targets.nextYearButton).toggleClass("inactive",!0),(r&&r.isAfter(moment(),"month")||i&&i.isBefore(moment(),"month"))&&this.element.find("."+this.options.targets.today).toggleClass("inactive",!0)}this.options.doneRendering&&this.options.doneRendering.apply(this,[])},u.prototype.bindEvents=function(){var t=e(this.element),n=this;t.on("click","."+this.options.targets.day,function(t){var r=n.buildTargetObject(t.currentTarget,!0);n.setSelected(r.date),n.options.clickEvents.click&&n.options.clickEvents.click.apply(n,[r]),n.options.adjacentDaysChangeMonth&&(e(t.currentTarget).is(".last-month")?n.backActionWithContext(n):e(t.currentTarget).is(".next-month")&&n.forwardActionWithContext(n))}),t.on("click","."+this.options.targets.empty,function(t){if(n.options.clickEvents.click){var r=n.buildTargetObject(t.currentTarget,!1);n.options.clickEvents.click.apply(n,[r])}n.options.adjacentDaysChangeMonth&&(e(t.currentTarget).is(".last-month")?n.backActionWithContext(n):e(t.currentTarget).is(".next-month")&&n.forwardActionWithContext(n))}),t.on("click","."+this.options.targets.previousButton,{context:this},this.backAction).on("click","."+this.options.targets.nextButton,{context:this},this.forwardAction).on("click","."+this.options.targets.todayButton,{context:this},this.todayAction).on("click","."+this.options.targets.nextYearButton,{context:this},this.nextYearAction).on("click","."+this.options.targets.previousYearButton,{context:this},this.previousYearAction).on("mousewheel","."+this.options.targets.scrollable,{context:this},this.scroll)},u.prototype.buildTargetObject=function(e,t){var n={element:e,date:null};if(t){var r,i=e.className.indexOf("calendar-day-");i!==0?(r=e.className.substring(i+13,i+23),n.date=moment(r)):n.date=null}return n},u.prototype.forwardAction=function(e){e.data.context.forward()},u.prototype.backAction=function(e){e.data.context.back()},u.prototype.scroll=function(e){e.preventDefault(),e.originalEvent.wheelDelta>=0?e.data.context.back():e.data.context.forward()},u.prototype.todayAction=function(e){var t=e.data.context,n=moment();t.applyChange(n,function(){t.options.clickEvents.today&&t.options.clickEvents.today.apply(t,[moment(t.intervalStart)])})},u.prototype.forward=function(){var e=this.intervalStart.clone().add(this.options.lengthOfTime.increment,this.options.lengthOfTime.intervalUnit).startOf(this.options.lengthOfTime.intervalUnit);return this.applyChange(e),this},u.prototype.back=function(e){var t=this.intervalStart.clone().subtract(this.options.lengthOfTime.increment,this.options.lengthOfTime.intervalUnit).startOf(this.options.lengthOfTime.intervalUnit);return this.applyChange(t),this},u.prototype.next=function(){return this.forward(),this},u.prototype.previous=function(){return this.back(),this},u.prototype.setIntervalStart=function(e){return this.applyChange(newIntervalStart),this},u.prototype.setSelected=function(e){return this.selectedDate=e,this.render(),this},u.prototype.applyChange=function(e,t){var n;this.intervalStart&&(n=this.intervalStart.clone()),this.setIntervalBounds(e),this.render(),n&&(this.callChangeHooks(n),t&&t(e,n))},u.prototype.callChangeHooks=function(e){this.options.clickEvents.previousInterval&&this.options.clickEvents.previousInterval.apply(this,[moment(this.intervalStart),moment(this.intervalEnd)]),this.options.clickEvents.onIntervalChange&&this.options.clickEvents.onIntervalChange.apply(this,[moment(this.intervalStart),moment(this.intervalEnd)]),this.options.clickEvents.previousMonth&&!e.isSame(this.intervalStart,"month")&&this.options.clickEvents.previousMonth.apply(this,[moment(this.intervalStart)]),this.options.clickEvents.onMonthChange&&!e.isSame(this.intervalStart,"month")&&this.options.clickEvents.onMonthChange.apply(this,[moment(this.intervalStart)]),this.options.clickEvents.onYearChange&&!e.isSame(this.intervalStart,"year")&&this.options.clickEvents.onYearChange.apply(this,[moment(this.intervalStart)])},u.prototype.setIntervalBounds=function(e){this.intervalStart=e,this.intervalEnd=this.intervalStart.clone().add(this.options.lengthOfTime.interval-1,this.options.lengthOfTime.intervalUnit).endOf(this.options.lengthOfTime.intervalUnit)},e.fn.clndr=function(e){if(this.length===1){if(!this.data("plugin_clndr")){var t=new u(this,e);return this.data("plugin_clndr",t),t}}else if(this.length>1)throw new Error("CLNDR does not support multiple elements yet. Make sure your clndr selector returns only one element.")}})(jQuery,window,document);